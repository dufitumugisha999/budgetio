<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Budgetio Â· tiny step</title>
    <!-- Poppins & icons (minimal) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: #eef3f8;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 6px;
        }

        /* ultra compact card â€“ no borders, same bg, small padding */
        .phone-frame {
            width: 100%;
            max-width: 340px;        /* narrow for small phones */
            background: #eef3f8;     /* matches body */
            border-radius: 36px;
            box-shadow: 0 15px 30px -10px #2d4b6e40;
            padding: 16px 14px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* header smaller */
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #103247;
            display: flex;
            align-items: center;
            gap: 4px;
            letter-spacing: -0.5px;
        }
        h1 i { color: #205b84; font-size: 1.8rem; }

        /* choice buttons (new/past) â€“ compact */
        .choice-row {
            display: flex;
            gap: 10px;
            margin: 4px 0 2px;
        }
        .choice-btn {
            background: #dae6f5;
            border-radius: 60px;
            padding: 14px 0;
            font-weight: 600;
            font-size: 1.2rem;
            color: #103247;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex: 1;
            box-shadow: 0 4px 10px -5px #345e83;
            cursor: pointer;
            border: none;
        }
        .choice-btn i { font-size: 1.2rem; }

        /* question panel â€“ tighter */
        .question-panel {
            background: #deeaf9;
            border-radius: 40px;
            padding: 18px 14px;
            box-shadow: inset 0 1px 4px #b7d0ea;
        }
        .field-label {
            font-size: 1rem;
            font-weight: 500;
            color: #103247;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .field-label i { font-size: 1.3rem; }

        .skip-row {
            display: flex;
            gap: 8px;
            margin: 8px 0;
        }
        .inp-skip {
            flex: 1;
            background: white;
            border: none;
            border-radius: 40px;
            padding: 12px 14px;
            font-size: 0.9rem;
            box-shadow: 0 2px 6px #aac3e0;
        }
        .inp-skip:focus { outline: 2px solid #3f78a4; }

        .action-btn {
            background: #c4daf5;
            border: none;
            border-radius: 40px;
            padding: 12px 18px;
            font-weight: 500;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 6px #9db9da;
            cursor: pointer;
        }
        .small-hint {
            font-size: 0.7rem;
            color: #2d5780;
            margin-top: 6px;
            text-align: right;
        }

        /* result panel â€“ compact metrics */
        .result-panel {
            background: #deeaf9;
            border-radius: 40px;
            padding: 18px 12px;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 12px 0;
        }
        .metric-cell {
            background: #eef3fc;
            border-radius: 32px;
            padding: 10px 4px;
            text-align: center;
            box-shadow: 0 2px 6px #b3cde8;
        }
        .metric-cell i { font-size: 1.2rem; }
        .metric-cell .value { font-size: 1.3rem; font-weight: 600; }
        .ai-suggest {
            background: #d2e4fb;
            border-radius: 30px;
            padding: 14px;
            font-size: 0.8rem;
            margin: 12px 0 6px;
        }
        .back-home {
            background: #c4daf5;
            border-radius: 40px;
            padding: 12px;
            text-align: center;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* past list â€“ very compact */
        .past-list {
            background: #deeaf9;
            border-radius: 36px;
            padding: 14px 10px;
            max-height: 280px;
            overflow-y: auto;
        }
        .history-item {
            background: #eef4fc;
            border-radius: 50px;
            padding: 10px 14px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.75rem;
            box-shadow: 0 2px 5px #b5ceec;
        }
        .delete-past {
            background: none;
            border: none;
            color: #7f9fc7;
            font-size: 1rem;
        }
        .clear-small {
            background: #d1e2f5;
            border-radius: 30px;
            padding: 8px 16px;
            font-size: 0.8rem;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .hidden { display: none; }
    </style>
</head>
<body>
<div class="phone-frame" id="app">
    <h1><i class="fas fa-calculator"></i> budgetio</h1>

    <!-- HOME (new / past) -->
    <div id="homeView">
        <div class="choice-row">
            <div class="choice-btn" id="newBtn"><i class="fas fa-plus"></i> NEW</div>
            <div class="choice-btn" id="pastBtn"><i class="fas fa-clock"></i> PAST</div>
        </div>
        <div style="font-size:0.7rem; text-align:center; color:#366188;">step by step Â· skip any</div>
    </div>

    <!-- QUESTION FLOW (one by one) -->
    <div id="questionView" class="hidden">
        <div class="question-panel">
            <div class="field-label" id="questionIcon"><i class="fas fa-wallet"></i> <span id="questionText">Income?</span></div>
            <div class="skip-row">
                <input type="number" id="stepInput" class="inp-skip" placeholder="0 or skip">
                <button class="action-btn" id="nextBtn"><i class="fas fa-arrow-right"></i></button>
            </div>
            <div style="display: flex; gap:6px; justify-content: space-between;">
                <button class="action-btn" id="skipBtn" style="padding:8px 12px;"><i class="fas fa-forward"></i> skip</button>
                <button class="action-btn" id="finishEarlyBtn" style="padding:8px 12px;"><i class="fas fa-chart-simple"></i> done</button>
            </div>
            <div class="small-hint" id="stepCounter">1/6</div>
        </div>
    </div>

    <!-- RESULT VIEW -->
    <div id="resultView" class="hidden">
        <div class="result-panel">
            <div style="font-weight:600; margin-bottom:4px;">ðŸ“Š snapshot</div>
            <div class="metric-grid" id="resultMetrics"></div>
            <div class="ai-suggest" id="resultAi">âœ¨ analysis</div>
            <div style="display:flex; gap:6px; margin:10px 0;">
                <button class="action-btn" id="saveResultBtn" style="flex:1;"><i class="fas fa-save"></i> save</button>
                <button class="action-btn" id="newFromResult" style="flex:1;"><i class="fas fa-plus"></i> new</button>
            </div>
            <div class="back-home" id="backHomeFromResult"><i class="fas fa-home"></i> home</div>
        </div>
    </div>

    <!-- PAST VIEW -->
    <div id="pastView" class="hidden">
        <div class="past-list" id="pastContainer"></div>
        <div style="display:flex; gap:10px; margin-top:12px;">
            <button class="clear-small" id="clearAllPast"><i class="fas fa-trash-alt"></i> clear</button>
            <button class="clear-small" id="backFromPast"><i class="fas fa-arrow-left"></i> back</button>
        </div>
    </div>
</div>

<script>
    (function() {
        // ---------- STORAGE ----------
        let history = JSON.parse(localStorage.getItem('budgetio_history')) || [];

        // ---------- STEP DEFINITIONS (tiny) ----------
        const steps = [
            { label: 'Income?', icon: 'fa-wallet', key: 'income' },
            { label: 'Investment?', icon: 'fa-chart-line', key: 'investment' },
            { label: 'Bills?', icon: 'fa-file-invoice', key: 'bills' },
            { label: 'Tax?', icon: 'fa-percent', key: 'tax' },
            { label: 'Other exp?', icon: 'fa-receipt', key: 'other' },
            { label: 'Extra earn?', icon: 'fa-hand-holding-usd', key: 'earnings' }
        ];

        let currentData = {
            income: null, investment: null, bills: null, tax: null, other: null, earnings: null
        };
        let currentStep = 0;

        // views
        const home = document.getElementById('homeView');
        const question = document.getElementById('questionView');
        const result = document.getElementById('resultView');
        const past = document.getElementById('pastView');

        // question elements
        const questionText = document.getElementById('questionText');
        const questionIcon = document.querySelector('#questionIcon i');
        const stepInput = document.getElementById('stepInput');
        const nextBtn = document.getElementById('nextBtn');
        const skipBtn = document.getElementById('skipBtn');
        const finishEarly = document.getElementById('finishEarlyBtn');
        const stepCounter = document.getElementById('stepCounter');

        // result elements
        const resultMetrics = document.getElementById('resultMetrics');
        const resultAi = document.getElementById('resultAi');
        const saveResultBtn = document.getElementById('saveResultBtn');
        const newFromResult = document.getElementById('newFromResult');
        const backHomeFromResult = document.getElementById('backHomeFromResult');

        // past elements
        const pastContainer = document.getElementById('pastContainer');
        const clearAllPast = document.getElementById('clearAllPast');
        const backFromPast = document.getElementById('backFromPast');

        // home buttons
        document.getElementById('newBtn').addEventListener('click', startNew);
        document.getElementById('pastBtn').addEventListener('click', showPast);

        // ---------- HELPERS ----------
        function hideAll() {
            home.classList.add('hidden');
            question.classList.add('hidden');
            result.classList.add('hidden');
            past.classList.add('hidden');
        }

        function startNew() {
            currentData = { income: null, investment: null, bills: null, tax: null, other: null, earnings: null };
            currentStep = 0;
            hideAll();
            question.classList.remove('hidden');
            updateStep();
        }

        function updateStep() {
            if (currentStep >= steps.length) {
                computeResult();
                return;
            }
            const s = steps[currentStep];
            questionText.innerText = s.label;
            if (questionIcon) questionIcon.className = `fas ${s.icon}`;
            stepInput.value = '';
            stepInput.placeholder = 'enter or skip';
            stepCounter.innerText = `${currentStep+1}/${steps.length}`;
        }

        function handleNext() {
            if (currentStep >= steps.length) return;
            const key = steps[currentStep].key;
            const val = stepInput.value.trim();
            if (val !== '') {
                const num = parseFloat(val);
                if (!isNaN(num)) currentData[key] = num;
                else currentData[key] = null;
            } else {
                currentData[key] = null;
            }
            currentStep++;
            if (currentStep < steps.length) updateStep();
            else computeResult();
        }

        function handleSkip() {
            if (currentStep >= steps.length) return;
            const key = steps[currentStep].key;
            currentData[key] = null;   // explicit skip
            currentStep++;
            if (currentStep < steps.length) updateStep();
            else computeResult();
        }

        nextBtn.addEventListener('click', (e) => { e.preventDefault(); handleNext(); });
        skipBtn.addEventListener('click', (e) => { e.preventDefault(); handleSkip(); });
        finishEarly.addEventListener('click', (e) => { e.preventDefault(); computeResult(); });

        // compute metrics (null -> 0)
        function getMetrics() {
            const inc = currentData.income || 0;
            const inv = currentData.investment || 0;
            const bills = currentData.bills || 0;
            const tax = currentData.tax || 0;
            const other = currentData.other || 0;
            const extra = currentData.earnings || 0;

            const totalIncome = inc + extra;
            const totalExp = bills + tax + other;
            const net = totalIncome - totalExp;
            const savings = net - inv;
            const sRate = totalIncome > 0 ? (savings / totalIncome) * 100 : 0;
            const liq = totalIncome > 0 ? (net / totalIncome) * 100 : 0;
            const invRatio = totalIncome > 0 ? (inv / totalIncome) * 100 : 0;

            return {
                totalIncome, net, savings,
                sRate: Math.round(sRate * 10) / 10,
                liq: Math.round(liq * 10) / 10,
                invRatio: Math.round(invRatio * 10) / 10,
                inv, bills, tax, other, inc, extra
            };
        }

        function shortAI(m) {
            if (m.totalIncome === 0) return "enter income to see tips";
            if (m.sRate < 0) return "âš ï¸ expenses exceed income â€” check bills";
            if (m.sRate < 10) return "savings rate <10% Â· try reducing 'other'";
            if (m.invRatio < 5) return "investment below 5% Â· consider small recurring";
            return "âœ… balanced Â· keep tracking";
        }

        function computeResult() {
            hideAll();
            result.classList.remove('hidden');
            const m = getMetrics();
            resultMetrics.innerHTML = `
                <div class="metric-cell"><i class="fas fa-coins"></i><div class="value">$${m.net.toFixed(0)}</div><div style="font-size:0.6rem;">net</div></div>
                <div class="metric-cell"><i class="fas fa-piggy-bank"></i><div class="value">${m.sRate}%</div><div style="font-size:0.6rem;">sRate</div></div>
                <div class="metric-cell"><i class="fas fa-shield"></i><div class="value">${m.liq}%</div><div style="font-size:0.6rem;">liq</div></div>
                <div class="metric-cell"><i class="fas fa-chart-pie"></i><div class="value">${m.invRatio}%</div><div style="font-size:0.6rem;">inv</div></div>
            `;
            resultAi.innerText = 'âœ¨ ' + shortAI(m);
        }

        // save current to history
        function saveCurrent() {
            const m = getMetrics();
            const date = new Date();
            const dateStr = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
            const entry = {
                date: dateStr,
                income: currentData.income,
                investment: currentData.investment,
                bills: currentData.bills,
                tax: currentData.tax,
                other: currentData.other,
                earnings: currentData.earnings,
                sRate: m.sRate,
                net: m.net
            };
            history.unshift(entry);
            if (history.length > 15) history.pop();
            localStorage.setItem('budgetio_history', JSON.stringify(history));
            alert('âœ“ saved');
        }

        saveResultBtn.addEventListener('click', saveCurrent);
        newFromResult.addEventListener('click', startNew);
        backHomeFromResult.addEventListener('click', () => {
            hideAll();
            home.classList.remove('hidden');
        });

        // ----- PAST VIEW -----
        function renderPast() {
            if (history.length === 0) {
                pastContainer.innerHTML = '<div style="padding:20px; text-align:center; color:#4a6f97;">no history</div>';
                return;
            }
            let html = '';
            history.forEach((item, idx) => {
                html += `<div class="history-item" data-past-idx="${idx}">
                    <span><i class="far fa-calendar-alt"></i> ${item.date || ''}</span>
                    <span style="font-weight:600;">${item.sRate ?? 0}%</span>
                    <button class="delete-past" data-del="${idx}"><i class="fas fa-times-circle"></i></button>
                </div>`;
            });
            pastContainer.innerHTML = html;

            // load entry
            document.querySelectorAll('.history-item').forEach(el => {
                el.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-past')) return;
                    const idx = el.getAttribute('data-past-idx');
                    if (idx && history[parseInt(idx)]) {
                        const entry = history[parseInt(idx)];
                        currentData = {
                            income: entry.income ?? null,
                            investment: entry.investment ?? null,
                            bills: entry.bills ?? null,
                            tax: entry.tax ?? null,
                            other: entry.other ?? null,
                            earnings: entry.earnings ?? null
                        };
                        computeResult();  // show result with that data
                    }
                });
            });

            document.querySelectorAll('.delete-past').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const idx = btn.getAttribute('data-del');
                    if (idx !== null) {
                        history.splice(parseInt(idx), 1);
                        localStorage.setItem('budgetio_history', JSON.stringify(history));
                        renderPast();
                    }
                });
            });
        }

        function showPast() {
            hideAll();
            past.classList.remove('hidden');
            renderPast();
        }

        clearAllPast.addEventListener('click', () => {
            if (confirm('Delete all?')) {
                history = [];
                localStorage.removeItem('budgetio_history');
                renderPast();
            }
        });

        backFromPast.addEventListener('click', () => {
            hideAll();
            home.classList.remove('hidden');
        });

        // allow enter key
        stepInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleNext();
            }
        });

        // start at home
        hideAll();
        home.classList.remove('hidden');
    })();
</script>
</body>
</html>
